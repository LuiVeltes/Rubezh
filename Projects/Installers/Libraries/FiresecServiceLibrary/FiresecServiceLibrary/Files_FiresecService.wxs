<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi"
		 xmlns:sql="http://schemas.microsoft.com/wix/SqlExtension"
		 xmlns:util="http://schemas.microsoft.com/wix/UtilExtension">
	<?include Variables_FiresecService.wxi?>
	<Fragment>
		<Property Id="FiresecServiceInstallDirId" Value="$(var.FiresecServiceLocationId)" />
		<Property Id="FiresecServiceName" Value="$(var.FiresecService.TargetFileName)" />
		<Property Id="OLDFIRESECINSTALLDIR" Value="C:\Program Files\Firesec" />
		<Property Id="OLDFIRESECFILESDIR" Value="..\..\FiresecBin" />

		<DirectoryRef Id="FIRESECSERVICELOCATION">
			<Component Id="MainExe" Guid="6A4260FA-49C4-499A-A6B9-508006C2BB3F">
				<File Id="FiresecServiceExe" Name="$(var.FiresecService.TargetFileName)"
							Source="$(var.FiresecService.TargetPath)" DiskId="1" KeyPath="yes">
				</File>
			</Component>

			<Component Id="FiresecServiceConfig" Guid="7B35878D-19EB-4552-BF09-E3D658D34957">
				<File Id="ServiceConfig" Name="FiresecService.exe.config" Source="$(var.FiresecService.TargetDir)"
							DiskId="1" KeyPath="yes" />
			</Component>

			<Component Id="CommonComponent" Guid="5B64430A-2E29-4C73-9C40-4823A9DB5709">
				<File Id="CommonDll" Name="$(var.Common.TargetFileName)" Source="$(var.Common.TargetPath)"
							DiskId="1" KeyPath="yes" />
			</Component>

			<Component Id="FiresecComponent" Guid="41974E04-F90D-4B43-9334-527425544AE8">
				<File Id="FiresecDll" Name="$(var.Firesec.TargetFileName)" Source="$(var.Firesec.TargetPath)"
							DiskId="1" KeyPath="yes" />
				<File Id="InteropFSTypes" Name="Interop.FS_Types.dll" Source="$(var.Firesec.TargetDir)"
							DiskId="1"/>
				<File Id="InteropMscoree" Name="Interop.mscoree.dll" Source="$(var.Firesec.TargetDir)"
							DiskId="1"/>
			</Component>

			<Component Id="FiresecAPIComponent" Guid="248BD6FE-8F57-42DF-BAE3-9EFCD5A1CC5A">
				<File Id="FiresecAPIDll" Name="$(var.FiresecAPI.TargetFileName)" Source="$(var.FiresecAPI.TargetPath)"
							DiskId="1" KeyPath="yes" />
			</Component>

			<Component Id="TrayComponent" Guid="DC1F2F70-E55F-497F-B48E-78BBEB1F6F3D">
				<File Id="TrayDll" Name="Hardcodet.Wpf.TaskbarNotification.dll" Source="$(var.FiresecService.TargetDir)"
							DiskId="1" KeyPath="yes">
				</File>
			</Component>
		</DirectoryRef>

		<DirectoryRef Id="FiresecServiceConfigFolder">
			<Component Id="PlansConfiguration" Guid="7389E335-B577-4D09-9E36-25A6FA75BDD7">
				<File Id="PlansConfiguration" Name="PlansConfiguration.xml" Source="$(var.FiresecService.TargetDir)\Configuration\"
							DiskId="1" KeyPath="yes">
				</File>
			</Component>
			<Component Id="SecurityConfiguration" Guid="024037C2-F2FD-4A06-A14B-A23B5179E6DE">
				<File Id="SecurityConfiguration" Name="SecurityConfiguration.xml" Source="$(var.FiresecService.TargetDir)\Configuration\"
							DiskId="1" KeyPath="yes">
				</File>
			</Component>
			<Component Id="DeviceLibrary" Guid="DF7CB00D-27E6-49CA-9CCE-B7B822C14B4A">
				<File Id="DeviceLibrary" Name="DeviceLibrary.xml" Source="$(var.FiresecService.TargetDir)\Configuration\"
							DiskId="1" KeyPath="yes">
				</File>
			</Component>
			<Component Id="DeviceConfiguration" Guid="188AAA95-581A-4352-B11E-38C0CDE13C16">
				<File Id="DeviceConfiguration" Name="DeviceConfiguration.xml" Source="$(var.FiresecService.TargetDir)\Configuration\"
							DiskId="1" KeyPath="yes">
				</File>
			</Component>
		</DirectoryRef>

		<!--<DirectoryRef Id="FIRESECSERVICELOCATION">
			<Component Id="CopyFiresecFiles" Guid="1A67E62A-0229-490E-BC25-0072E96EA54A">
				<CreateFolder Directory="FIRESECSERVICELOCATION" />
				<CopyFile Id="Copy_FS_Server.Exe" DestinationProperty="OLDFIRESECINSTALLDIR" SourceDirectory="..\..\FiresecBin" SourceName="FS_Server.Exe"/>
				<CopyFile Id="Copy_FS_Types.dll" DestinationProperty="OLDFIRESECINSTALLDIR" SourceDirectory="..\..\FiresecBin" SourceName="FS_Types.dll"/>
				<CopyFile Id="Copy_fscTest.exe" DestinationProperty="OLDFIRESECINSTALLDIR" SourceDirectory="..\..\FiresecBin" SourceName="fscTest.exe"/>
				<CopyFile Id="Copy_rubezh2010.xml" DestinationProperty="OLDFIRESECINSTALLDIR" SourceDirectory="..\..\FiresecBin" SourceName="rubezh2010.xml"/>
				<CopyFile Id="Copy_SockProxy.dll" DestinationProperty="OLDFIRESECINSTALLDIR" SourceDirectory="..\..\FiresecBin" SourceName="SockProxy.dll"/>
			</Component>
		</DirectoryRef>-->

		<DirectoryRef Id="FIRESECSERVICELOCATION">
			<Component Id="FSServerComponent" Guid="*" >
				<File Id="FS_Server.Exe" Source="..\..\FiresecBin\FS_Server.Exe" DiskId="1" KeyPath="yes">
					<CopyFile Id="Copy_FS_Server.Exe" DestinationProperty="OLDFIRESECINSTALLDIR" />
				</File>
			</Component>
			<Component Id="FSTypesComponent" Guid="*">
				<File Id="FS_Types.dll" Source="..\..\FiresecBin\FS_Types.dll" DiskId="1" KeyPath="yes">
					<CopyFile Id="Copy_FS_Types.dll" DestinationProperty="OLDFIRESECINSTALLDIR" />
				</File>
			</Component>
			<Component Id="FscTestComponent" Guid="*">
				<File Id="fscTest.exe" Source="..\..\FiresecBin\fscTest.exe" DiskId="1" KeyPath="yes">
					<CopyFile Id="Copy_fscTest.exe" DestinationProperty="OLDFIRESECINSTALLDIR" />
				</File>
			</Component>
			<Component Id="Rubezh2010Component" Guid="*">
				<File Id="rubezh2010.xml" Source="..\..\FiresecBin\rubezh2010.xml" DiskId="1" KeyPath="yes">
					<CopyFile Id="Copy_rubezh2010.xml" DestinationProperty="OLDFIRESECINSTALLDIR"/>
				</File>
			</Component>
			<Component Id="SockProxyComponent" Guid="*" >
				<File Id="SockProxy.dll" Source="..\..\FiresecBin\SockProxy.dll" DiskId="1" KeyPath="yes">
					<CopyFile Id="Copy_SockProxy.dll" DestinationProperty="OLDFIRESECINSTALLDIR" />
				</File>
			</Component>
		</DirectoryRef>
	</Fragment>
</Wix>