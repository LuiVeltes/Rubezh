<UserControl x:Class="DiagnosticsModule.Views.DevicesTreeView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:c="clr-namespace:Controls;assembly=Controls"
             xmlns:Views="clr-namespace:DevicesModule.Views;assembly=DevicesModule"
             MinWidth="600" MinHeight="600">

	<UserControl.Resources>
		<ContextMenu x:Key="DeviceContextMenu">
			<MenuItem Command="{Binding CopyCommand}" Header="Копировать" />
			<MenuItem Command="{Binding CutCommand}" Header="Вырезать" />
			<MenuItem Command="{Binding PasteCommand}" Header="Вставить" />
			<MenuItem Command="{Binding PasteAsCommand}" Header="Вставить как" />
			<Separator />
			<MenuItem Command="{Binding AddCommand}" Header="Добавить" />
			<MenuItem Command="{Binding AddManyCommand}" Header="Добавить несколько" />
			<MenuItem Command="{Binding RemoveCommand}" Header="Удалить" />
			<MenuItem Command="{Binding ShowZoneLogicCommand}" Header="Настройка логики" Visibility="{Binding Driver.IsZoneLogicDevice, Converter={StaticResource BoolToVisibilityConverter}}" />
			<MenuItem Command="{Binding ShowPropertiesCommand}" Header="Свойства" />
		</ContextMenu>

		<HierarchicalDataTemplate x:Key="dt" ItemsSource="{Binding Children}" />
	</UserControl.Resources>
	<Grid>
		<Grid.Resources>
			<Style x:Key="{x:Type ComboBox}" BasedOn="{StaticResource {x:Type ComboBox}}" TargetType="ComboBox">
				<Setter Property="MinWidth" Value="0" />
				<Setter Property="MinHeight" Value="0" />
			</Style>
			<Style x:Key="{x:Type TextBox}" BasedOn="{StaticResource {x:Type TextBox}}" TargetType="TextBox">
				<Setter Property="MinWidth" Value="0" />
				<Setter Property="MinHeight" Value="0" />
			</Style>
		</Grid.Resources>
		<Grid.RowDefinitions>
			<RowDefinition Height="*" />
		</Grid.RowDefinitions>
		<TabControl>
			<TabItem Header="DEBUG">
				<c:TreeListView ItemsSource="{Binding Devices}" ItemTemplate="{StaticResource dt}">
					<c:TreeListView.Resources>
						<Style BasedOn="{StaticResource {x:Type c:TreeListViewItem}}" TargetType="{x:Type c:TreeListViewItem}"/>
					</c:TreeListView.Resources>
					<c:TreeListView.Columns>
						<GridViewColumn Width="250" Header="Устройство">
							<GridViewColumn.CellTemplate>
								<DataTemplate>
									<c:EditorPresenter>
										<c:EditorPresenter.ViewTemplate>
											<ControlTemplate>
												<StackPanel ContextMenu="{StaticResource DeviceContextMenu}" Orientation="Horizontal" Background="Transparent">
													<CheckBox IsChecked="{Binding IsUsed, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Visibility="{Binding Device.CanBeNotUsed, Converter={StaticResource BoolToVisibilityConverter}}" />
													<Image Width="16" Height="16" Margin="5, 0, 5, 0" Source="{Binding Driver.ImageSource}" />
													<TextBlock HorizontalAlignment="Stretch" VerticalAlignment="Center" Text="{Binding Driver.ShortName}" />
												</StackPanel>
											</ControlTemplate>
										</c:EditorPresenter.ViewTemplate>
										<c:EditorPresenter.EditTemplate>
											<ControlTemplate>
												<DockPanel ContextMenu="{StaticResource DeviceContextMenu}">
													<StackPanel DockPanel.Dock="Left" Orientation="Horizontal">
														<CheckBox IsChecked="{Binding IsUsed, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Visibility="{Binding Device.CanBeNotUsed, Converter={StaticResource BoolToVisibilityConverter}}" />
														<Image Width="16" Height="16" Margin="5, 0, 5, 0" Source="{Binding Driver.ImageSource}" />
														<TextBlock VerticalAlignment="Center" Text="{Binding Driver.ShortName}" Visibility="{Binding CanChangeDriver, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=True}" />
													</StackPanel>
													<ComboBox ItemsSource="{Binding AvailvableDrivers}" SelectedItem="{Binding Driver, UpdateSourceTrigger=PropertyChanged}" Visibility="{Binding CanChangeDriver, Converter={StaticResource BoolToVisibilityConverter}}">
														<ComboBox.ItemTemplate>
															<DataTemplate>
																<TextBlock Foreground="Black" Text="{Binding ShortName}" />
															</DataTemplate>
														</ComboBox.ItemTemplate>
													</ComboBox>
												</DockPanel>
											</ControlTemplate>
										</c:EditorPresenter.EditTemplate>
									</c:EditorPresenter>
								</DataTemplate>
							</GridViewColumn.CellTemplate>
						</GridViewColumn>
						<GridViewColumn Width="100" Header="Адрес">
							<GridViewColumn.CellTemplate>
								<DataTemplate>
									<c:EditorPresenter>
										<c:EditorPresenter.ViewTemplate>
											<ControlTemplate>
												<TextBlock Text="{Binding Address}" Visibility="{Binding Driver.HasAddress, Converter={StaticResource BoolToVisibilityConverter}}" />
											</ControlTemplate>
										</c:EditorPresenter.ViewTemplate>
										<c:EditorPresenter.EditTemplate>
											<ControlTemplate>
												<Grid>
													<Views:AddressEditor Address="{Binding Address, UpdateSourceTrigger=Default}" Device="{Binding Device}" Visibility="{Binding Device.CanEditAddress, Converter={StaticResource BoolToVisibilityConverter}}" />
													<TextBlock Text="{Binding Address}" Visibility="{Binding Device.CanEditAddress, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=True}" />
												</Grid>
											</ControlTemplate>
										</c:EditorPresenter.EditTemplate>
									</c:EditorPresenter>
								</DataTemplate>
							</GridViewColumn.CellTemplate>
						</GridViewColumn>
						<GridViewColumn Width="100" Header="Зона">
							<GridViewColumn.CellTemplate>
								<DataTemplate>
									<c:EditorPresenter>
										<c:EditorPresenter.ViewTemplate>
											<ControlTemplate>
												<StackPanel Orientation="Horizontal" Background="Transparent">
													<Image Width="14" Height="14" Margin="0, 0 ,5, 0" Source="/Controls;component/Images/Link.png" Visibility="{Binding HasExternalDevices, Converter={StaticResource BoolToVisibilityConverter}}" />
													<TextBlock Text="{Binding PresentationZone}" ToolTip="{Binding PresentationZone}" />
												</StackPanel>
											</ControlTemplate>
										</c:EditorPresenter.ViewTemplate>
										<c:EditorPresenter.EditTemplate>
											<ControlTemplate>
												<Grid>
													<ComboBox VerticalAlignment="Stretch" VerticalContentAlignment="Stretch" ItemsSource="{Binding Zones}" SelectedItem="{Binding Zone, UpdateSourceTrigger=PropertyChanged}" Visibility="{Binding IsZoneDevice, Converter={StaticResource BoolToVisibilityConverter}}">
														<ComboBox.ItemTemplate>
															<DataTemplate>
																<TextBlock VerticalAlignment="Stretch" Foreground="Black" Text="{Binding PresentationName}" />
															</DataTemplate>
														</ComboBox.ItemTemplate>
													</ComboBox>
													<TextBlock Text="{Binding PresentationZone}" Visibility="{Binding Driver.IsZoneLogicDevice, Converter={StaticResource BoolToVisibilityConverter}}">
														<TextBlock.InputBindings>
															<MouseBinding Command="{Binding ShowZoneLogicCommand}" MouseAction="LeftDoubleClick" />
														</TextBlock.InputBindings>
													</TextBlock>
												</Grid>
											</ControlTemplate>
										</c:EditorPresenter.EditTemplate>
									</c:EditorPresenter>
								</DataTemplate>
							</GridViewColumn.CellTemplate>
						</GridViewColumn>
						<GridViewColumn Header="Примечание">
							<GridViewColumn.CellTemplate>
								<DataTemplate>
									<c:EditorPresenter>
										<c:EditorPresenter.ViewTemplate>
											<ControlTemplate>
												<TextBlock Text="{Binding Description}" />
											</ControlTemplate>
										</c:EditorPresenter.ViewTemplate>
										<c:EditorPresenter.EditTemplate>
											<ControlTemplate>
												<TextBox Name="descriptionTextBox" HorizontalAlignment="Stretch" BorderThickness="0" Foreground="Black" Text="{Binding Description, UpdateSourceTrigger=PropertyChanged}" />
												<ControlTemplate.Triggers>
													<Trigger SourceName="descriptionTextBox" Property="IsVisible" Value="True">
														<Setter TargetName="descriptionTextBox" Property="FocusManager.FocusedElement" Value="{Binding ElementName=descriptionTextBox}" />
													</Trigger>
												</ControlTemplate.Triggers>
											</ControlTemplate>
										</c:EditorPresenter.EditTemplate>
									</c:EditorPresenter>
								</DataTemplate>
							</GridViewColumn.CellTemplate>
						</GridViewColumn>
					</c:TreeListView.Columns>
				</c:TreeListView>
			</TabItem>
			<TabItem Header="TreeListView">
				<c:TreeListView ItemsSource="{Binding Devices}" ItemTemplate="{StaticResource dt}">
					<c:TreeListView.Columns>
						<GridViewColumn Width="250" Header="Устройство">
							<GridViewColumn.CellTemplate>
								<DataTemplate>
									<c:EditorPresenter>
										<c:EditorPresenter.ViewTemplate>
											<ControlTemplate>
												<StackPanel ContextMenu="{StaticResource DeviceContextMenu}" Orientation="Horizontal" Background="Transparent">
													<CheckBox IsChecked="{Binding IsUsed, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Visibility="{Binding Device.CanBeNotUsed, Converter={StaticResource BoolToVisibilityConverter}}" />
													<Image Width="16" Height="16" Margin="5, 0, 5, 0" Source="{Binding Driver.ImageSource}" />
													<TextBlock HorizontalAlignment="Stretch" VerticalAlignment="Center" Text="{Binding Driver.ShortName}" />
												</StackPanel>
											</ControlTemplate>
										</c:EditorPresenter.ViewTemplate>
										<c:EditorPresenter.EditTemplate>
											<ControlTemplate>
												<DockPanel ContextMenu="{StaticResource DeviceContextMenu}">
													<StackPanel DockPanel.Dock="Left" Orientation="Horizontal">
														<CheckBox IsChecked="{Binding IsUsed, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Visibility="{Binding Device.CanBeNotUsed, Converter={StaticResource BoolToVisibilityConverter}}" />
														<Image Width="16" Height="16" Margin="5, 0, 5, 0" Source="{Binding Driver.ImageSource}" />
														<TextBlock VerticalAlignment="Center" Text="{Binding Driver.ShortName}" Visibility="{Binding CanChangeDriver, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=True}" />
													</StackPanel>
													<ComboBox ItemsSource="{Binding AvailvableDrivers}" SelectedItem="{Binding Driver, UpdateSourceTrigger=PropertyChanged}" Visibility="{Binding CanChangeDriver, Converter={StaticResource BoolToVisibilityConverter}}">
														<ComboBox.ItemTemplate>
															<DataTemplate>
																<TextBlock Foreground="Black" Text="{Binding ShortName}" />
															</DataTemplate>
														</ComboBox.ItemTemplate>
													</ComboBox>
												</DockPanel>
											</ControlTemplate>
										</c:EditorPresenter.EditTemplate>
									</c:EditorPresenter>
								</DataTemplate>
							</GridViewColumn.CellTemplate>
						</GridViewColumn>
						<GridViewColumn Width="100" Header="Адрес">
							<GridViewColumn.CellTemplate>
								<DataTemplate>
									<c:EditorPresenter>
										<c:EditorPresenter.ViewTemplate>
											<ControlTemplate>
												<TextBlock Text="{Binding Address}" Visibility="{Binding Driver.HasAddress, Converter={StaticResource BoolToVisibilityConverter}}" />
											</ControlTemplate>
										</c:EditorPresenter.ViewTemplate>
										<c:EditorPresenter.EditTemplate>
											<ControlTemplate>
												<Grid>
													<Views:AddressEditor Address="{Binding Address, UpdateSourceTrigger=Default}" Device="{Binding Device}" Visibility="{Binding Device.CanEditAddress, Converter={StaticResource BoolToVisibilityConverter}}" />
													<TextBlock Text="{Binding Address}" Visibility="{Binding Device.CanEditAddress, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=True}" />
												</Grid>
											</ControlTemplate>
										</c:EditorPresenter.EditTemplate>
									</c:EditorPresenter>
								</DataTemplate>
							</GridViewColumn.CellTemplate>
						</GridViewColumn>
						<GridViewColumn Width="100" Header="Зона">
							<GridViewColumn.CellTemplate>
								<DataTemplate>
									<c:EditorPresenter>
										<c:EditorPresenter.ViewTemplate>
											<ControlTemplate>
												<StackPanel Orientation="Horizontal" Background="Transparent">
													<Image Width="14" Height="14" Margin="0, 0 ,5, 0" Source="/Controls;component/Images/Link.png" Visibility="{Binding HasExternalDevices, Converter={StaticResource BoolToVisibilityConverter}}" />
													<TextBlock Text="{Binding PresentationZone}" ToolTip="{Binding PresentationZone}" />
												</StackPanel>
											</ControlTemplate>
										</c:EditorPresenter.ViewTemplate>
										<c:EditorPresenter.EditTemplate>
											<ControlTemplate>
												<Grid>
													<ComboBox VerticalAlignment="Stretch" VerticalContentAlignment="Stretch" ItemsSource="{Binding Zones}" SelectedItem="{Binding Zone, UpdateSourceTrigger=PropertyChanged}" Visibility="{Binding IsZoneDevice, Converter={StaticResource BoolToVisibilityConverter}}">
														<ComboBox.ItemTemplate>
															<DataTemplate>
																<TextBlock VerticalAlignment="Stretch" Foreground="Black" Text="{Binding PresentationName}" />
															</DataTemplate>
														</ComboBox.ItemTemplate>
													</ComboBox>
													<TextBlock Text="{Binding PresentationZone}" Visibility="{Binding Driver.IsZoneLogicDevice, Converter={StaticResource BoolToVisibilityConverter}}">
														<TextBlock.InputBindings>
															<MouseBinding Command="{Binding ShowZoneLogicCommand}" MouseAction="LeftDoubleClick" />
														</TextBlock.InputBindings>
													</TextBlock>
												</Grid>
											</ControlTemplate>
										</c:EditorPresenter.EditTemplate>
									</c:EditorPresenter>
								</DataTemplate>
							</GridViewColumn.CellTemplate>
						</GridViewColumn>
						<GridViewColumn Header="Примечание">
							<GridViewColumn.CellTemplate>
								<DataTemplate>
									<c:EditorPresenter>
										<c:EditorPresenter.ViewTemplate>
											<ControlTemplate>
												<TextBlock Text="{Binding Description}" />
											</ControlTemplate>
										</c:EditorPresenter.ViewTemplate>
										<c:EditorPresenter.EditTemplate>
											<ControlTemplate>
												<TextBox Name="descriptionTextBox" HorizontalAlignment="Stretch" BorderThickness="0" Foreground="Black" Text="{Binding Description, UpdateSourceTrigger=PropertyChanged}" />
												<ControlTemplate.Triggers>
													<Trigger SourceName="descriptionTextBox" Property="IsVisible" Value="True">
														<Setter TargetName="descriptionTextBox" Property="FocusManager.FocusedElement" Value="{Binding ElementName=descriptionTextBox}" />
													</Trigger>
												</ControlTemplate.Triggers>
											</ControlTemplate>
										</c:EditorPresenter.EditTemplate>
									</c:EditorPresenter>
								</DataTemplate>
							</GridViewColumn.CellTemplate>
						</GridViewColumn>
					</c:TreeListView.Columns>
				</c:TreeListView>
			</TabItem>
			<TabItem Header="TreeListView Expanded">
				<c:TreeListView Grid.Row="1" ItemsSource="{Binding Devices2}" ItemTemplate="{StaticResource dt}" RowHeight="19">
					<c:TreeListView.Columns>
						<GridViewColumn Width="250" Header="Устройство">
							<GridViewColumn.CellTemplate>
								<DataTemplate>
									<c:EditorPresenter>
										<c:EditorPresenter.ViewTemplate>
											<ControlTemplate>
												<StackPanel ContextMenu="{StaticResource DeviceContextMenu}" Orientation="Horizontal">
													<CheckBox IsChecked="{Binding IsUsed, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Visibility="{Binding Device.CanBeNotUsed, Converter={StaticResource BoolToVisibilityConverter}}" />
													<Image Width="16" Height="16" Margin="5, 0, 5, 0" Source="{Binding Driver.ImageSource}" />
													<TextBlock HorizontalAlignment="Stretch" VerticalAlignment="Center" Text="{Binding Driver.ShortName}" />
												</StackPanel>
											</ControlTemplate>
										</c:EditorPresenter.ViewTemplate>
										<c:EditorPresenter.EditTemplate>
											<ControlTemplate>
												<DockPanel ContextMenu="{StaticResource DeviceContextMenu}">
													<StackPanel DockPanel.Dock="Left" Orientation="Horizontal">
														<CheckBox IsChecked="{Binding IsUsed, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Visibility="{Binding Device.CanBeNotUsed, Converter={StaticResource BoolToVisibilityConverter}}" />
														<Image Width="16" Height="16" Margin="5, 0, 5, 0" Source="{Binding Driver.ImageSource}" />
														<TextBlock VerticalAlignment="Center" Text="{Binding Driver.ShortName}" Visibility="{Binding CanChangeDriver, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=True}" />
													</StackPanel>
													<ComboBox ItemsSource="{Binding AvailvableDrivers}" SelectedItem="{Binding Driver, UpdateSourceTrigger=PropertyChanged}" Visibility="{Binding CanChangeDriver, Converter={StaticResource BoolToVisibilityConverter}}">
														<ComboBox.ItemTemplate>
															<DataTemplate>
																<TextBlock Foreground="Black" Text="{Binding ShortName}" />
															</DataTemplate>
														</ComboBox.ItemTemplate>
													</ComboBox>
												</DockPanel>
											</ControlTemplate>
										</c:EditorPresenter.EditTemplate>
									</c:EditorPresenter>
								</DataTemplate>
							</GridViewColumn.CellTemplate>
						</GridViewColumn>
						<GridViewColumn Width="100" Header="Адрес">
							<GridViewColumn.CellTemplate>
								<DataTemplate>
									<c:EditorPresenter>
										<c:EditorPresenter.ViewTemplate>
											<ControlTemplate>
												<TextBlock Text="{Binding Address}" Visibility="{Binding Driver.HasAddress, Converter={StaticResource BoolToVisibilityConverter}}" />
											</ControlTemplate>
										</c:EditorPresenter.ViewTemplate>
										<c:EditorPresenter.EditTemplate>
											<ControlTemplate>
												<Grid>
													<Views:AddressEditor Address="{Binding Address}" Device="{Binding Device}" Visibility="{Binding Device.CanEditAddress, Converter={StaticResource BoolToVisibilityConverter}}" />
													<TextBlock Text="{Binding Address}" Visibility="{Binding Device.CanEditAddress, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=True}" />
												</Grid>
											</ControlTemplate>
										</c:EditorPresenter.EditTemplate>
									</c:EditorPresenter>
								</DataTemplate>
							</GridViewColumn.CellTemplate>
						</GridViewColumn>
						<GridViewColumn Width="100" Header="Зона">
							<GridViewColumn.CellTemplate>
								<DataTemplate>
									<c:EditorPresenter>
										<c:EditorPresenter.ViewTemplate>
											<ControlTemplate>
												<StackPanel Orientation="Horizontal">
													<Image Width="14" Height="14" Margin="0, 0 ,5, 0" Source="/Controls;component/Images/Link.png" Visibility="{Binding HasExternalDevices, Converter={StaticResource BoolToVisibilityConverter}}" />
													<TextBlock Text="{Binding PresentationZone}" ToolTip="{Binding PresentationZone}" />
												</StackPanel>
											</ControlTemplate>
										</c:EditorPresenter.ViewTemplate>
										<c:EditorPresenter.EditTemplate>
											<ControlTemplate>
												<Grid>
													<ComboBox VerticalAlignment="Stretch" VerticalContentAlignment="Stretch" ItemsSource="{Binding Zones}" SelectedItem="{Binding Zone, UpdateSourceTrigger=PropertyChanged}" Visibility="{Binding IsZoneDevice, Converter={StaticResource BoolToVisibilityConverter}}">
														<ComboBox.ItemTemplate>
															<DataTemplate>
																<TextBlock VerticalAlignment="Stretch" Foreground="Black" Text="{Binding PresentationName}" />
															</DataTemplate>
														</ComboBox.ItemTemplate>
													</ComboBox>
													<TextBlock Text="{Binding PresentationZone}" Visibility="{Binding Driver.IsZoneLogicDevice, Converter={StaticResource BoolToVisibilityConverter}}">
														<TextBlock.InputBindings>
															<MouseBinding Command="{Binding ShowZoneLogicCommand}" MouseAction="LeftDoubleClick" />
														</TextBlock.InputBindings>
													</TextBlock>
												</Grid>
											</ControlTemplate>
										</c:EditorPresenter.EditTemplate>
									</c:EditorPresenter>
								</DataTemplate>
							</GridViewColumn.CellTemplate>
						</GridViewColumn>
						<GridViewColumn Header="Примечание">
							<GridViewColumn.CellTemplate>
								<DataTemplate>
									<c:EditorPresenter>
										<c:EditorPresenter.ViewTemplate>
											<ControlTemplate>
												<TextBlock Text="{Binding Description}" />
											</ControlTemplate>
										</c:EditorPresenter.ViewTemplate>
										<c:EditorPresenter.EditTemplate>
											<ControlTemplate>
												<TextBox Name="descriptionTextBox" HorizontalAlignment="Stretch" BorderThickness="0" Foreground="Black" Text="{Binding Description}" />
											</ControlTemplate>
										</c:EditorPresenter.EditTemplate>
									</c:EditorPresenter>
								</DataTemplate>
							</GridViewColumn.CellTemplate>
						</GridViewColumn>
					</c:TreeListView.Columns>
				</c:TreeListView>
			</TabItem>
			<TabItem Header="ListView">
				<ListView ItemsSource="{Binding Zones}">
					<ListView.View>
						<GridView>
							<GridViewColumn DisplayMemberBinding="{Binding Zone.No}" Header="№" />
							<GridViewColumn DisplayMemberBinding="{Binding Zone.Name}" Header="Наименование" />
							<GridViewColumn DisplayMemberBinding="{Binding Zone.Description}" Header="Примечание" />
							<GridViewColumn DisplayMemberBinding="{Binding DetectorCount}" Header="Число ИП для перехода в пожар" />
						</GridView>
					</ListView.View>
				</ListView>
			</TabItem>
			<TabItem Header="DataGrid">
				<DataGrid AutoGenerateColumns="False" ItemsSource="{Binding Zones}">
					<DataGrid.Columns>
						<DataGridTextColumn Width="1*" Binding="{Binding Zone.No}" Header="№" />
						<DataGridTextColumn Width="2*" Binding="{Binding Zone.Name}" Header="Наименование" />
						<DataGridTextColumn Width="2*" Binding="{Binding Zone.Description}" Header="Примечание" />
						<DataGridTextColumn Width="2*" Binding="{Binding DetectorCount}" Header="Число ИП для перехода в пожар" />
					</DataGrid.Columns>
				</DataGrid>
			</TabItem>
		</TabControl>
	</Grid>
</UserControl>