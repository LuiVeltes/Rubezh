<UserControl x:Class="GKModule.Views.MPTsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:Controls="clr-namespace:Controls;assembly=Controls">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="2*" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <Grid Grid.Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="1*" MinWidth="200" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="2*" MinWidth="200" />
            </Grid.ColumnDefinitions>
            <Controls:XDataGrid Grid.Column="0" ItemsSource="{Binding MPTs}" SelectedItem="{Binding SelectedMPT}" Margin="2">
                <DataGrid.Columns>
                    <DataGridTemplateColumn Header="Название" MinWidth="250" Width="*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <Image Margin="1 0 0 0" Width="16" Source="/Controls;component/Images/BMPT.png" VerticalAlignment="Center" />
                                    <TextBlock Width="200" Text="{Binding MPT.Name}" HorizontalAlignment="Stretch" VerticalAlignment="Center" />
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </Controls:XDataGrid>

            <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Background="Transparent" Cursor="SizeWE" />

            <Grid Grid.Column="2" Visibility="{Binding HasSelectedMPT, Converter={StaticResource BoolToVisibilityConverter}}" Margin="2">
                <Grid DataContext="{Binding SelectedMPT}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <StackPanel Grid.Row="0" Orientation="Horizontal">
                        <Controls:ToolBarButton Command="{Binding AddCommand}" ToolTip="Добавить" ImageSource="/Controls;component/Images/add.png" />
                        <Controls:ToolBarButton Command="{Binding DeleteCommand}" ToolTip="Удалить" ImageSource="/Controls;component/Images/delete.png" />
                    </StackPanel>
                    <DataGrid ItemsSource="{Binding Devices}" SelectedItem="{Binding SelectedDevice}" Grid.Row="1">
                        <DataGrid.Columns>
                            <DataGridTemplateColumn Header="Тип" MinWidth="200" Width="Auto">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <ComboBox ItemsSource="{Binding AvailableMPTDeviceTypes}" SelectedItem="{Binding MPTDeviceType, UpdateSourceTrigger=PropertyChanged}" VerticalAlignment="Center" VerticalContentAlignment="Center">
                                            <ComboBox.ItemTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding ., Converter={StaticResource MPTDeviceTypeToStringConverter}}" Foreground="Black" />
                                                </DataTemplate>
                                            </ComboBox.ItemTemplate>
                                        </ComboBox>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTemplateColumn Header="Устройство" MinWidth="200" Width="Auto">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal">
                                            <Image Source="{Binding Device.Driver.ImageSource}" Width="16" Margin="2 0 0 0" />
                                            <TextBlock Text="{Binding Device.ShortName}" HorizontalAlignment="Stretch" VerticalAlignment="Center" Margin="2" />
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTextColumn Header="Адрес" Binding="{Binding Device.DottedAddress}" MinWidth="100" Width="Auto" />
                            <DataGridTextColumn Header="Примечание" Binding="{Binding Description}" MinWidth="100" Width="*" />
                        </DataGrid.Columns>
                    </DataGrid>
                    <StackPanel Grid.Row="2" DataContext="{Binding SelectedDevice}" Margin="2">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Примечание" Width="200" Foreground="White" Margin="2" />
                            <TextBox Text="{Binding Description}" Width="200" Margin="2" />
                        </StackPanel>

                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Visibility="{Binding HasDelay, Converter={StaticResource BoolToVisibilityConverter}}">
                                <TextBlock Text="Задержка" Width="200" Foreground="White" Margin="2" />
                                <TextBox Text="{Binding Delay}" Width="200" Margin="2" />
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Visibility="{Binding HasHold, Converter={StaticResource BoolToVisibilityConverter}}">
                                <TextBlock Text="Удержание" Width="200" Foreground="White" Margin="2" />
                                <TextBox Text="{Binding Hold}" Width="200" Margin="2" />
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>
                </Grid>
            </Grid>
        </Grid>

        <Border Grid.Row="1" CornerRadius="5" Background="White" Margin="2 7 2 2">
            <Grid Visibility="{Binding HasSelectedMPT, Converter={StaticResource BoolToVisibilityConverter}}">
                <StackPanel DataContext="{Binding SelectedMPT}" Margin="2">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Условие для запуска" FontWeight="Bold" Width="250" Margin="5 2" />
                        <TextBlock VerticalAlignment="Center" Margin="2">
				            <Hyperlink Command="{Binding ChangeStartLogicCommand}" Style="{StaticResource HyperlinkStyle2}">
					            <TextBlock Margin="2">
						            <TextBlock.Style>
							            <Style>
								            <Setter Property="TextBlock.Text" Value="{Binding StartPresentationName}" />
								            <Style.Triggers>
									            <DataTrigger Binding="{Binding StartPresentationName}" Value="">
										            <Setter Property="TextBlock.Text" Value="Нажмите для выбора логики" />
									            </DataTrigger>
								            </Style.Triggers>
							            </Style>
						            </TextBlock.Style>
					            </TextBlock>
				            </Hyperlink>
			            </TextBlock>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Задержка" Width="200" Margin="2" />
                        <TextBox Text="{Binding Delay}" Width="200" Background="LightGray" Margin="2" />
                    </StackPanel>


                    <CheckBox IsChecked="{Binding UseDoorAutomatic}" Content="Отключать автоматику при срабатывании датчика двери-окна" Margin="2" />
                    <CheckBox IsChecked="{Binding UseDoorStop}" Content="Останавливать при срабатывании датчика двери-окна" Margin="2" />
                    <CheckBox IsChecked="{Binding UseFailureAutomatic}" Content="Отключать автоматику при неисправности любого устройства" Margin="2" />

                </StackPanel>
            </Grid>
        </Border>
        
    </Grid>
</UserControl>