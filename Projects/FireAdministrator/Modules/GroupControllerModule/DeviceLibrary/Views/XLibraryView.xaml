<UserControl x:Class="GKModule.Views.XLibraryView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:Controls="clr-namespace:Controls;assembly=Controls"
             xmlns:ExtToolkit="clr-namespace:Microsoft.Windows.Controls;assembly=WPFToolkit.Extended">
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="300" />
            <ColumnDefinition />
        </Grid.ColumnDefinitions>
        <DataGrid Grid.Column="0" ItemsSource="{Binding XDevices}" SelectedItem="{Binding SelectedXDevice}" Margin="2">
            <DataGrid.Columns>
                <DataGridTemplateColumn Header="Устройство" Width="*">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <Image Width="14" Source="{Binding XDriver.ImageSource}" Margin="5, 0, 0, 0" />
                                <TextBlock Text="{Binding XDriver.ShortName}" Margin="5, 0, 0, 0" />
                            </StackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
            <DataGrid.ContextMenu>
                <ContextMenu>
                    <MenuItem Header="Добавить устройство" Command="{Binding AddXDeviceCommand}" />
                    <MenuItem Header="Удалить устройство" Command="{Binding RemoveXDeviceCommand}" />
                </ContextMenu>
            </DataGrid.ContextMenu>
        </DataGrid>
        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="400" />
            </Grid.RowDefinitions>
            <DataGrid Grid.Row="0" ItemsSource="{Binding XStates}" SelectedItem="{Binding SelectedXState}" Margin="2">
                <DataGrid.Columns>
                    <DataGridTemplateColumn Header="Состояние">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <Image Source="{Binding XState.StateType, Converter={StaticResource XStateTypeToIconConverter}}" Width="16" />
                                    <TextBlock Text="{Binding ClassName}" />
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTextColumn Header="Описание" Binding="{Binding AdditionalName}" Width="*" />
                </DataGrid.Columns>
                <DataGrid.ContextMenu>
                    <ContextMenu>
                        <MenuItem Header="Добавить состояние" Command="{Binding AddXStateCommand}" />
                        <MenuItem Header="Удалить состояние" Command="{Binding RemoveXStateCommand}" />
                    </ContextMenu>
                </DataGrid.ContextMenu>
            </DataGrid>
            <Grid Grid.Row="1" Visibility="{Binding IsDebug, Converter={StaticResource BoolToVisibilityConverter}, Mode=OneWay}" Height="100">
                <TextBox AcceptsReturn="True" AcceptsTab="True" HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto"
                         DataContext="{Binding SelectedXState.SelectedXFrame.XFrame}" Text="{Binding Image}" Margin="2" />
            </Grid>
            <Grid Grid.Row="2" Margin="5 0 0 0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>
                <TabControl Name="FramesTab" Grid.Row="1" Grid.Column="0" DataContext="{Binding SelectedXState}"
                            ItemsSource="{Binding XFrames}" SelectedItem="{Binding SelectedXFrame}" TabStripPlacement="Bottom">
                    <TabControl.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" ContextMenuOpening="OnContextMenuOpening">
                                <TextBlock Text="Кадр " />
                                <TextBlock Text="{Binding XFrame.Id}" />
                                <StackPanel.ContextMenu>
                                    <ContextMenu ContextMenuOpening="OnContextMenuOpening">
                                        <MenuItem Command="{Binding AddXFrameCommand}" Header="Добавить кадр" />
                                        <MenuItem Command="{Binding RemoveXFrameCommand}" Header="Удалить кадр" />
                                    </ContextMenu>
                                </StackPanel.ContextMenu>
                            </StackPanel>
                        </DataTemplate>
                    </TabControl.ItemTemplate>
                    <TabControl.ContentTemplate>
                        <DataTemplate>
                            <DockPanel>
                                <StackPanel Orientation="Horizontal" DockPanel.Dock="Bottom">
                                    <StackPanel Orientation="Horizontal"
                                                DataContext="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TabControl}}, Path=DataContext}"
                                                Visibility="{Binding IsLayerEditingVisible, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                                        <Label Content="Слой: " VerticalAlignment="Center" />
                                        <ExtToolkit:IntegerUpDown Minimum="-10" Maximum="10" IsEditable="False" Text="{Binding Layer, Mode=TwoWay}" Height="20" Width="50" />
                                    </StackPanel>
                                    <Label Content=" Длительность, мс: " VerticalAlignment="Center" />
                                    <ExtToolkit:IntegerUpDown Minimum="100" Maximum="10000" Increment="100" IsEditable="False" Text="{Binding Duration, Mode=TwoWay}" Height="20" Width="75" />
                                    <Controls:ToolBarButton Command="{Binding ImportSvgCommand}" ToolTip="Импорт из .svg" ImageSource="/Controls;component/Images/Arrow-up-left.png" />
                                    <Controls:ToolBarButton Command="{Binding ExportSvgCommand}" ToolTip="Экспорт в .svg" ImageSource="/Controls;component/Images/Arrow-down-right.png" />
                                </StackPanel>
                                <ContentControl Content="{Binding XamlOfImage}" Width="500" Height="500" HorizontalAlignment="Center" Margin="0, 0, 150, 0">
                                    <ContentControl.LayoutTransform>
                                        <ScaleTransform ScaleX="0.5" ScaleY="0.5" />
                                    </ContentControl.LayoutTransform>
                                </ContentControl>
                            </DockPanel>
                        </DataTemplate>
                    </TabControl.ContentTemplate>
                </TabControl>
                <StackPanel  Grid.Row="1" Grid.Column="1" Margin="-150, 50, 0, 0">
                    <Slider Name="sliderScale" Cursor="Hand" Minimum="0.01" Maximum="0.15" Value="1.0"
                        Visibility="{Binding XDeviceControl, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}}" Margin="5" />
                    <ContentControl Width="500" Height="500" Content="{Binding XDeviceControl, Mode=OneWay}">
                        <ContentControl.LayoutTransform>
                            <ScaleTransform CenterX="0.5" CenterY="0.5"
                                ScaleX="{Binding ElementName=sliderScale, Path=Value, Mode=OneWay}"
                                ScaleY="{Binding ElementName=sliderScale, Path=Value, Mode=OneWay}" />
                        </ContentControl.LayoutTransform>
                    </ContentControl>
                </StackPanel>
            </Grid>
        </Grid>
    </Grid>
</UserControl>