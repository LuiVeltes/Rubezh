<UserControl x:Class="DevicesModule.Views.DeviceConfigurationView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:Views="clr-namespace:DevicesModule.Views"
    MinWidth="600" MinHeight="600">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        <Grid Grid.Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition />
                <ColumnDefinition />
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>
            <Label Grid.Row="0" Grid.Column="0" Content="Текущая конфигурация" Margin="2" />
            <Label Grid.Row="0" Grid.Column="1" Content="Конфигурация в устройстве" Margin="2" />

            <DataGrid ScrollViewer.ScrollChanged="DataGrid1_ScrollChanged" Selector.SelectionChanged ="dataGrid1RowSelected" Name="DataGrid1"  Grid.Row="1" Grid.Column="0" DataContext="{Binding LocalDevices}" Margin="2" ItemsSource="{Binding Devices}" SelectedItem="{Binding SelectedDevice}" VirtualizingStackPanel.IsVirtualizing="True">
                <DataGrid.Columns>
                    <DataGridTemplateColumn Header="Устройство" Width="250">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" Margin="{Binding Level, Converter={StaticResource LevelToMarginConverter}}">
                                    <CheckBox Style="{StaticResource TreeExpanderStyle}" IsChecked="{Binding IsExpanded, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                        Visibility="{Binding HasChildren, Converter={StaticResource BoolToVisibilityConverter}}" />
                                    <Image Source="{Binding Driver.ImageSource}" Width="16" Height="16" Margin="5, 0, 5, 0" />
                                    <TextBlock Name="textBlock" Text="{Binding Driver.ShortName}" HorizontalAlignment="Stretch" />
                                </StackPanel>
                                <DataTemplate.Resources>
                                    <Style TargetType="{x:Type TextBlock}">
                                        <Style.Triggers>
                                            <MultiDataTrigger>
                                                <MultiDataTrigger.Conditions>
                                                    <Condition Binding="{Binding IsLocal}" Value="false"/>
                                                    <Condition Binding="{Binding IsRemote}" Value="true"/>
                                                </MultiDataTrigger.Conditions>
                                                <Setter Property="Foreground" Value="#ACA899"/>
                                            </MultiDataTrigger>
                                            <MultiDataTrigger>
                                                <MultiDataTrigger.Conditions>
                                                    <Condition Binding="{Binding IsLocal}" Value="true"/>
                                                    <Condition Binding="{Binding IsRemote}" Value="false"/>
                                                </MultiDataTrigger.Conditions>
                                                <Setter Property="FontWeight" Value="Bold"/>
                                            </MultiDataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </DataTemplate.Resources>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTextColumn Header="Адрес" Binding="{Binding Address}" Width="100" />
                    <DataGridTextColumn Header="Зона" Binding="{Binding PresentationZone}" Width="100" />
                </DataGrid.Columns>
            </DataGrid>
            <DataGrid ScrollViewer.ScrollChanged="DataGrid2_ScrollChanged" Selector.SelectionChanged ="dataGrid2RowSelected" Name="DataGrid2" Grid.Row="1" Grid.Column="1" DataContext="{Binding RemoteDevices}" Margin="2" ItemsSource="{Binding Devices}" SelectedItem="{Binding SelectedDevice}" VirtualizingStackPanel.IsVirtualizing="True">
                <DataGrid.Columns>
                    <DataGridTemplateColumn Header="Устройство" Width="250">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" Margin="{Binding Level, Converter={StaticResource LevelToMarginConverter}}">
                                    <CheckBox Style="{StaticResource TreeExpanderStyle}" IsChecked="{Binding IsExpanded, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                        Visibility="{Binding HasChildren, Converter={StaticResource BoolToVisibilityConverter}}" />
                                    <Image Source="{Binding Driver.ImageSource}" Width="16" Height="16" Margin="5, 0, 5, 0" />
                                    <TextBlock Text="{Binding Driver.ShortName}" HorizontalAlignment="Stretch" />
                                </StackPanel>
                                <DataTemplate.Resources>
                                    <Style TargetType="{x:Type TextBlock}">
                                        <Style.Triggers>
                                            <MultiDataTrigger>
                                                <MultiDataTrigger.Conditions>
                                                    <Condition Binding="{Binding IsLocal}" Value="true"/>
                                                    <Condition Binding="{Binding IsRemote}" Value="false"/>
                                                </MultiDataTrigger.Conditions>
                                                <Setter Property="Foreground" Value="#ACA899"/>
                                            </MultiDataTrigger>
                                            <MultiDataTrigger>
                                                <MultiDataTrigger.Conditions>
                                                    <Condition Binding="{Binding IsLocal}" Value="false"/>
                                                    <Condition Binding="{Binding IsRemote}" Value="true"/>
                                                </MultiDataTrigger.Conditions>
                                                <Setter Property="FontWeight" Value="Bold"/>
                                            </MultiDataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </DataTemplate.Resources>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTextColumn Header="Адрес" Binding="{Binding Address}" Width="100" />
                    <DataGridTextColumn Header="Зона" Binding="{Binding PresentationZone}" Width="100" />
                </DataGrid.Columns>
            </DataGrid>
        </Grid>
        <StackPanel Grid.Row="1">
            <Button Content="Заменить текущую конфигурацию" Command="{Binding ReplaceCommand}" HorizontalAlignment="Left" Width="300" Margin="2" />
        </StackPanel>
    </Grid>
</UserControl>