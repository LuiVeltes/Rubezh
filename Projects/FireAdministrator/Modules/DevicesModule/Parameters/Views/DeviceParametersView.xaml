<UserControl x:Class="DevicesModule.Views.DeviceParametersView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:Controls="clr-namespace:Controls;assembly=Controls"
             xmlns:Conv="clr-namespace:Controls.Converters;assembly=Controls"
             xmlns:Converters="clr-namespace:DevicesModule.Converters"
             xmlns:drag="clr-namespace:Infrastructure.Common.Services.DragDrop;assembly=Infrastructure.Common"
             xmlns:toolkit="clr-namespace:System.Windows.Controls;assembly=System.Windows.Controls.Input.Toolkit"
             xmlns:tree="clr-namespace:Controls.TreeList;assembly=Controls"
             xmlns:viewModel="clr-namespace:DevicesModule.ViewModels"
             xmlns:Views="clr-namespace:DevicesModule.Views"
             Focusable="True">
    <UserControl.Resources>
        <viewModel:DeviceViewModelDeviceComparer x:Key="DeviceViewModelDeviceComparer" />
        <viewModel:DeviceViewModelAddressComparer x:Key="DeviceViewModelAddressComparer" />
        <viewModel:DeviceViewModelZoneComparer x:Key="DeviceViewModelZoneComparer" />
        <viewModel:DeviceViewModelDescriptionComparer x:Key="DeviceViewModelDescriptionComparer" />
        <Style TargetType="Label" x:Key="PropertyCaptionStyle">
            <Setter Property="Content" Value="{Binding Caption}" />
            <Setter Property="ToolTip" Value="{Binding Caption}" />
            <Setter Property="HorizontalAlignment" Value="Right" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="Foreground" Value="White" />
        </Style>
    </UserControl.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>
        <tree:TreeList Grid.Column="0" Focusable="True" SelectedTreeNode="{Binding SelectedDevice}" Source="{Binding RootDevices}" tree:SortBehavior.CanUserSortColumns="True">
            <tree:TreeList.Resources>
                <Style x:Key="{x:Type ComboBox}" BasedOn="{StaticResource {x:Type ComboBox}}" TargetType="ComboBox">
                    <Setter Property="MinWidth" Value="0" />
                    <Setter Property="MinHeight" Value="0" />
                </Style>
                <Style x:Key="{x:Type TextBox}" BasedOn="{StaticResource {x:Type TextBox}}" TargetType="TextBox">
                    <Setter Property="MinWidth" Value="0" />
                    <Setter Property="MinHeight" Value="0" />
                </Style>
            </tree:TreeList.Resources>
            <tree:TreeList.View>
                <GridView>
                    <GridViewColumn Width="250" Header="Устройство" tree:SortBehavior.SortComparer="{StaticResource DeviceViewModelDeviceComparer}">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <Controls:EditorPresenter>
                                    <Controls:EditorPresenter.ViewTemplate>
                                        <ControlTemplate>
                                            <Grid>
                                                <Image Width="16" Height="16" Margin="5, 0, 5, 0" HorizontalAlignment="Left" Source="{Binding Driver.ImageSource}" />
                                                <TextBlock Width="200" Margin="31 0 0 0" HorizontalAlignment="Stretch" VerticalAlignment="Center" Text="{Binding Driver.ShortName}" />
                                            </Grid>
                                        </ControlTemplate>
                                    </Controls:EditorPresenter.ViewTemplate>
                                </Controls:EditorPresenter>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                    <GridViewColumn Width="100" Header="Адрес" tree:SortBehavior.SortComparer="{StaticResource DeviceViewModelAddressComparer}">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <Controls:EditorPresenter>
                                    <Controls:EditorPresenter.ViewTemplate>
                                        <ControlTemplate>
                                            <TextBlock Text="{Binding Address}" Visibility="{Binding Driver.HasAddress, Converter={StaticResource BoolToVisibilityConverter}}" />
                                        </ControlTemplate>
                                    </Controls:EditorPresenter.ViewTemplate>
                                </Controls:EditorPresenter>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                    <GridViewColumn Width="200" Header="Зона" tree:SortBehavior.SortComparer="{StaticResource DeviceViewModelZoneComparer}">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <Image Width="14" Height="14" Margin="0, 0 ,5, 0" Source="/Controls;component/Images/Link.png" Visibility="{Binding HasExternalDevices, Converter={StaticResource BoolToVisibilityConverter}}" />
                                    <TextBlock Name="ZoneTextBlock" MinWidth="100" Cursor="Hand" Text="{Binding EditingPresentationZone}" ToolTip="{Binding EditingPresentationZone}" Visibility="{Binding IsZoneOrLogic, Converter={StaticResource BoolToVisibilityConverter}}">
										<TextBlock.Style>
											<Style TargetType="TextBlock">
												<Style.Triggers>
													<DataTrigger Binding="{Binding IsZoneGrayed}" Value="True">
														<Setter Property="TextBlock.Foreground" Value="Gray" />
													</DataTrigger>
												</Style.Triggers>
											</Style>
										</TextBlock.Style>
                                    </TextBlock>
                                </StackPanel>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                    <GridViewColumn Header="Примечание" tree:SortBehavior.SortComparer="{StaticResource DeviceViewModelDescriptionComparer}">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <Controls:EditorPresenter>
                                    <Controls:EditorPresenter.ViewTemplate>
                                        <ControlTemplate>
                                            <TextBlock Text="{Binding Description}" />
                                        </ControlTemplate>
                                    </Controls:EditorPresenter.ViewTemplate>
                                </Controls:EditorPresenter>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                </GridView>
            </tree:TreeList.View>
        </tree:TreeList>
        <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Background="Transparent" Cursor="SizeNS" />
        <Border Grid.Column="2" Background="{DynamicResource BackgroundBrush}" CornerRadius="5"
                DataContext="{Binding OneDeviceParameterViewModel}">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition SharedSizeGroup="group1" Width="*" />
                            <ColumnDefinition SharedSizeGroup="group2" Width="*" />
                            <ColumnDefinition SharedSizeGroup="group3" Width="*" />
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0" Text="Название" Foreground="White" FontWeight="Bold" Margin="2" />
                        <TextBlock Grid.Column="1" Text="В системе" Foreground="White" FontWeight="Bold" Margin="2" />
                        <TextBlock Grid.Column="2" Text="В устройстве" Foreground="White" FontWeight="Bold" Margin="2" />
                    </Grid>

                    <ItemsControl ItemsSource="{Binding StringProperties}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition SharedSizeGroup="group1" Width="*" />
                                        <ColumnDefinition SharedSizeGroup="group2" Width="*" />
                                        <ColumnDefinition SharedSizeGroup="group3" Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <Label Grid.Column="0" Style="{StaticResource PropertyCaptionStyle}" />
                                    <TextBox Grid.Column="1" Text="{Binding Text, UpdateSourceTrigger=PropertyChanged}" Margin="2" VerticalAlignment="Center" />
                                    <TextBlock Grid.Column="2" Text="{Binding DeviceValue}" Foreground="White" Margin="2" />
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    <ItemsControl ItemsSource="{Binding BoolProperties}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition SharedSizeGroup="group1" Width="*" />
                                        <ColumnDefinition SharedSizeGroup="group2" Width="*" />
                                        <ColumnDefinition SharedSizeGroup="group3" Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <Label Grid.Column="0" Style="{StaticResource PropertyCaptionStyle}" />
                                    <CheckBox Grid.Column="1" IsChecked="{Binding IsChecked, UpdateSourceTrigger=PropertyChanged}" Margin="2" VerticalAlignment="Center" />
                                    <TextBlock Grid.Column="2" Text="{Binding DeviceValue}" Foreground="White" Margin="2" />
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    <ItemsControl ItemsSource="{Binding EnumProperties}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition SharedSizeGroup="group1" Width="*" />
                                        <ColumnDefinition SharedSizeGroup="group2" Width="*" />
                                        <ColumnDefinition SharedSizeGroup="group3" Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <Label Grid.Column="0" Style="{StaticResource PropertyCaptionStyle}" />
                                    <ComboBox Grid.Column="1" ItemsSource="{Binding Parameters}" SelectedItem="{Binding SelectedParameter, UpdateSourceTrigger=PropertyChanged}" Margin="2" VerticalAlignment="Center">
                                        <ComboBox.ItemTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Name}" />
                                            </DataTemplate>
                                        </ComboBox.ItemTemplate>
                                    </ComboBox>
                                    <TextBlock Grid.Column="2" Text="{Binding DeviceValue}" Foreground="White" Margin="2" />
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </ScrollViewer>
        </Border>
    </Grid>
</UserControl>