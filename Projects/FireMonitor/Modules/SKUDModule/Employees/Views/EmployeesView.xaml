<UserControl x:Class="SKDModule.Views.EmployeesView" xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:Controls="clr-namespace:Controls;assembly=Controls" xmlns:tree="clr-namespace:Controls.TreeList;assembly=Controls" xmlns:Views="clr-namespace:SKDModule.Views">

	<UserControl.Resources>
		<Style x:Key="ItemsControlStyle" TargetType="{x:Type ItemsControl}">
			<Style.Setters>
				<EventSetter Event="PreviewMouseDown" Handler="ItemsControl_MouseDown" />
			</Style.Setters>
		</Style>
	</UserControl.Resources>

	<Grid>
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto" />
			<RowDefinition Height="*" />
		</Grid.RowDefinitions>
		<StackPanel Grid.Row="0" Orientation="Horizontal">
			<Controls:ToolBarButton Command="{Binding ShowFilterCommand}" ImageSource="/Controls;component/Images/Filter.png" ToolTip="Задать фильтр" />
			<StackPanel Orientation="Horizontal" Visibility="{Binding IsCard, Converter={StaticResource InversedBoolToVisibilityConverter}}">
				<Controls:ToolBarButton Command="{Binding AddCommand}" ImageSource="/Controls;component/Images/Add.png" ToolTip="Добавить пользователя" />
				<Controls:ToolBarButton Command="{Binding RemoveCommand}" ImageSource="/Controls;component/Images/Delete.png" ToolTip="Удалить пользователя" />
				<Controls:ToolBarButton Command="{Binding EditCommand}" ImageSource="/Controls;component/Images/Edit.png" ToolTip="Редактировать пользователя" />
				<Controls:ToolBarButton Command="{Binding AddCardCommand}" ImageSource="/Controls;component/Images/Add.png" ToolTip="Добавить карту" />
			</StackPanel>
			<StackPanel Orientation="Horizontal" Visibility="{Binding IsCard, Converter={StaticResource BoolToVisibilityConverter}}">
				<StackPanel DataContext="{Binding SelectedCard}" Orientation="Horizontal" Visibility="{Binding IsCardBold, Converter={StaticResource BoolToVisibilityConverter}}">
					<Controls:ToolBarButton Command="{Binding RemoveCommand}" ImageSource="/Controls;component/Images/Delete.png" ToolTip="Удалить карту" />
					<Controls:ToolBarButton Command="{Binding EditCommand}" ImageSource="/Controls;component/Images/Edit.png" ToolTip="Редактировать карту" />
				</StackPanel>
				<StackPanel Orientation="Horizontal" Visibility="{Binding SelectedCard.IsPassBold, Converter={StaticResource BoolToVisibilityConverter}}">
					<Controls:ToolBarButton Command="{Binding PassCardViewModel.PrintCommand}" ImageSource="/Controls;component/Images/Print.png" ToolTip="Печать пропуска" />
				</StackPanel>
			</StackPanel>
		</StackPanel>

		<Grid Grid.Row="1">
			<Grid.RowDefinitions>
				<RowDefinition Height="*" MinHeight="200" />
				<RowDefinition Height="Auto" />
				<RowDefinition Height="*" MinHeight="200" />
			</Grid.RowDefinitions>
			<DataGrid Name="_dataGrid" Grid.Row="0" Margin="2" ItemsSource="{Binding Employees}" Loaded="_dataGrid_Loaded" RowDetailsVisibilityMode="Visible" SelectedItem="{Binding SelectedEmployee}">
				<DataGrid.CellStyle>
					<Style TargetType="{x:Type DataGridCell}">
						<Style.Setters>
							<Setter Property="Template">
								<Setter.Value>
									<ControlTemplate TargetType="{x:Type DataGridCell}">
										<Border Background="{TemplateBinding Background}" BorderThickness="0">
											<ContentPresenter VerticalAlignment="Center" />
										</Border>
									</ControlTemplate>
								</Setter.Value>
							</Setter>
							<EventSetter Event="PreviewMouseDown" Handler="Border_PreviewMouseDown" />
						</Style.Setters>
						<Style.Triggers>
							<Trigger Property="IsSelected" Value="True">
								<Setter Property="Background" Value="{DynamicResource PressedBackgroundBrush}" />
								<Setter Property="Foreground" Value="White" />
							</Trigger>
						</Style.Triggers>
					</Style>
				</DataGrid.CellStyle>
				<DataGrid.RowDetailsTemplate>
					<DataTemplate>
						<ItemsControl ItemsSource="{Binding Cards}" Style="{StaticResource ItemsControlStyle}" Visibility="{Binding IsExpanded, Converter={StaticResource BoolToVisibilityConverter}}">
							<ItemsControl.ItemTemplate>
								<DataTemplate>
									<StackPanel Orientation="Horizontal">
										<TextBlock Width="200">
											<Hyperlink Command="{Binding SelectCardCommand}" Style="{StaticResource HyperlinkStyle2}">
												<StackPanel Orientation="Horizontal">
													<TextBlock Margin="10 2" Text="Идентификатор" />
													<TextBlock Margin="10 2" Text="{Binding Card.PresentationName}" />
												</StackPanel>
											</Hyperlink>
											<TextBlock.Style>
												<Style>
													<Style.Triggers>
														<DataTrigger Binding="{Binding IsCardBold}" Value="True">
															<DataTrigger.Setters>
																<Setter Property="TextBlock.FontWeight" Value="Bold" />
															</DataTrigger.Setters>
														</DataTrigger>
													</Style.Triggers>
												</Style>
											</TextBlock.Style>
										</TextBlock>
										<CheckBox Margin="10 2" Content="Заблокирован" IsChecked="{Binding IsBlocked}" />

										<TextBlock Width="200">
											<Hyperlink Command="{Binding SelectPassCommand}" Style="{StaticResource HyperlinkStyle2}">
												<StackPanel Orientation="Horizontal">
													<TextBlock Margin="10 2" Text="Пропуск" />
												</StackPanel>
											</Hyperlink>
											<TextBlock.Style>
												<Style>
													<Style.Triggers>
														<DataTrigger Binding="{Binding IsPassBold}" Value="True">
															<DataTrigger.Setters>
																<Setter Property="TextBlock.FontWeight" Value="Bold" />
															</DataTrigger.Setters>
														</DataTrigger>
													</Style.Triggers>
												</Style>
											</TextBlock.Style>
										</TextBlock>

									</StackPanel>
								</DataTemplate>
							</ItemsControl.ItemTemplate>
						</ItemsControl>
					</DataTemplate>
				</DataGrid.RowDetailsTemplate>
				<DataGrid.Columns>
					<DataGridTemplateColumn Width="*" Header="Имя">
						<DataGridTemplateColumn.CellTemplate>
							<DataTemplate>
								<TextBlock>
									<Hyperlink Command="{Binding ChangeIsExpandedCommand}" Style="{StaticResource HyperlinkStyle2}">
										<StackPanel Orientation="Horizontal">
											<Image Margin="1 0 0 0" VerticalAlignment="Center" Source="/Controls;component/Images/zone.png" />
											<TextBlock Margin="2" VerticalAlignment="Center" Text="{Binding Employee.FirstName}" />
										</StackPanel>
									</Hyperlink>
								</TextBlock>
							</DataTemplate>
						</DataGridTemplateColumn.CellTemplate>
					</DataGridTemplateColumn>
					<DataGridTextColumn Binding="{Binding Employee.SecondName}" Header="Фамилия" />
					<DataGridTextColumn Binding="{Binding Employee.LastName}" Header="Отчество" />
				</DataGrid.Columns>
			</DataGrid>
			<GridSplitter Grid.Row="1" Height="5" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Background="Transparent" Cursor="SizeNS" />

			<Grid Grid.Row="2" Visibility="{Binding IsCard, Converter={StaticResource InversedBoolToVisibilityConverter}}">
				<Border Background="White" CornerRadius="5">
					<StackPanel Margin="5" DataContext="{Binding RealSelectedEmployee}">
						<StackPanel Orientation="Horizontal">
							<TextBlock Width="100" Margin="2" Text="Имя" />
							<TextBlock Margin="2" Text="{Binding Employee.FirstName}" />
						</StackPanel>

						<StackPanel Orientation="Horizontal">
							<TextBlock Width="100" Margin="2" Text="Фамилия" />
							<TextBlock Margin="2" Text="{Binding Employee.SecondName}" />
						</StackPanel>

						<StackPanel Orientation="Horizontal">
							<TextBlock Width="100" Margin="2" Text="Отчество" />
							<TextBlock Margin="2" Text="{Binding Employee.LastName}" />
						</StackPanel>

						<StackPanel Orientation="Horizontal">
							<TextBlock Width="100" Margin="2" Text="Отдел" />
							<TextBlock Margin="2" Text="{Binding DepartmentName}" />
						</StackPanel>

						<StackPanel Orientation="Horizontal">
							<TextBlock Width="100" Margin="2" Text="Должность" />
							<TextBlock Margin="2" Text="{Binding PositionName}" />
						</StackPanel>
					</StackPanel>
				</Border>
			</Grid>

			<Grid Grid.Row="2" Visibility="{Binding IsCard, Converter={StaticResource BoolToVisibilityConverter}}">
				<Grid>
					<Grid DataContext="{Binding SelectedCard}" Visibility="{Binding IsPassBold, Converter={StaticResource InversedBoolToVisibilityConverter}}">
						<Grid.RowDefinitions>
							<RowDefinition Height="Auto" />
							<RowDefinition Height="*" />
						</Grid.RowDefinitions>
						<StackPanel Grid.Row="0" Orientation="Horizontal">
							<StackPanel Margin="10 0" Orientation="Horizontal">
								<TextBlock Grid.Row="0" Grid.Column="0" Margin="2" HorizontalAlignment="Right" Foreground="White" Text="Идентификатор" />
								<TextBlock Grid.Row="0" Grid.Column="1" Margin="2" HorizontalAlignment="Left" Foreground="White" Text="{Binding Card.PresentationName}" />
							</StackPanel>

							<StackPanel Margin="10 0" Orientation="Horizontal">
								<TextBlock Grid.Row="1" Grid.Column="0" Margin="2" HorizontalAlignment="Right" Foreground="White" Text="Начало действия" />
								<TextBlock Grid.Row="1" Grid.Column="1" Margin="2" HorizontalAlignment="Left" Foreground="White" Text="{Binding Card.ValidFrom, StringFormat=dd-MM-yyyy}" />
							</StackPanel>

							<StackPanel Margin="10 0" Orientation="Horizontal">
								<TextBlock Grid.Row="2" Grid.Column="0" Margin="2" HorizontalAlignment="Right" Foreground="White" Text="Конец действия" />
								<TextBlock Grid.Row="2" Grid.Column="1" Margin="2" HorizontalAlignment="Left" Foreground="White" Text="{Binding Card.ValidTo, StringFormat=dd-MM-yyyy}" />
							</StackPanel>
						</StackPanel>
						<Views:CardZonesView Grid.Row="1" DataContext="{Binding CardZonesViewModel}" />
					</Grid>
					<Grid Visibility="{Binding SelectedCard.IsPassBold, Converter={StaticResource BoolToVisibilityConverter}}">
						<ContentPresenter Content="{Binding PassCardViewModel}" />
					</Grid>
				</Grid>
			</Grid>
		</Grid>
	</Grid>
</UserControl>